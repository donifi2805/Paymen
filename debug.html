<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BYPASS DEBUG CONSOLE - Pandawa Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #030712; color: #e2e8f0; font-family: 'Consolas', 'Courier New', monospace; }
        .console-box { background-color: #000000; border: 1px solid #1e293b; border-radius: 8px; padding: 12px; height: 300px; overflow-y: auto; font-size: 11px; line-height: 1.5; }
        .log-time { color: #64748b; margin-right: 8px; }
        .log-info { color: #38bdf8; }
        .log-success { color: #4ade80; }
        .log-error { color: #f43f5e; }
        .log-warning { color: #fbbf24; }
        input { background: #0f172a !important; border: 1px solid #334155 !important; color: #fff !important; }
        input:focus { border-color: #3b82f6 !important; outline: none; }
        .btn-action { transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .btn-action:active { transform: scale(0.95); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-2xl font-black text-white italic">PANDAWA <span class="text-blue-500">DEBUG</span></h1>
                <p class="text-xs text-gray-500">Mode: Direct Bypass API (Tanpa Firebase Login)</p>
            </div>
            <div id="vendorStatus" class="flex gap-2">
                <span class="text-[10px] bg-orange-500/10 text-orange-500 border border-orange-500/20 px-3 py-1 rounded-full font-bold">BYPASS ACTIVE</span>
                <span class="text-[10px] bg-blue-500/10 text-blue-500 border border-blue-500/20 px-3 py-1 rounded-full font-bold">PROXY READY</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-800 shadow-xl">
                    <h2 class="text-sm font-bold text-gray-400 mb-4 flex items-center gap-2">
                        <i class="fas fa-edit"></i> INPUT TRANSAKSI
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 mb-1 ml-1">NOMOR TUJUAN</label>
                            <input type="tel" id="targetNum" class="w-full h-11 px-4 rounded-xl text-sm" placeholder="Contoh: 08123456789">
                        </div>
                        
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 mb-1 ml-1">KODE PRODUK (SKU)</label>
                            <input type="text" id="productCode" class="w-full h-11 px-4 rounded-xl text-sm" placeholder="Contoh: XDA13, XLA25, dsb">
                        </div>

                        <div class="pt-2 space-y-2">
                            <button onclick="executeBypass('KHFY')" class="btn-action w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl text-xs shadow-lg shadow-blue-600/20">
                                Kirim via KHFY
                            </button>
                            <button onclick="executeBypass('ICS')" class="btn-action w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 rounded-xl text-xs shadow-lg shadow-cyan-600/20">
                                Kirim via ICS (Akrab)
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-blue-500/5 p-4 rounded-2xl border border-blue-500/10">
                    <h3 class="text-[10px] font-black text-blue-500 uppercase mb-2">Peringatan Teknis</h3>
                    <p class="text-[10px] text-gray-400 leading-relaxed">
                        Mode bypass ini langsung memotong saldo **Pusat/Vendor**. Gunakan hanya untuk pengetesan jika system login Firebase bermasalah. Transaksi tidak akan muncul di riwayat aplikasi utama.
                    </p>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-4">
                <div class="flex justify-between items-end">
                    <h2 class="text-sm font-bold text-gray-400 flex items-center gap-2">
                        <i class="fas fa-code"></i> LIVE DEBUG CONSOLE
                    </h2>
                    <button onclick="clearConsole()" class="text-[10px] text-gray-500 hover:text-white transition">CLEAR</button>
                </div>
                
                <div id="consoleLog" class="console-box">
                    <div class="log-info">-- Pandawa System Debug Terminal Ready --</div>
                    <div class="log-info">-- Proxy: CodeTabs/CorsProxy Active --</div>
                </div>

                <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                    <h3 class="text-xs font-bold text-gray-400 mb-3">Pengecekan Cepat</h3>
                    <div class="flex gap-2">
                        <input type="text" id="checkReff" class="flex-1 h-9 px-3 rounded-lg text-[10px]" placeholder="Masukkan Reff ID untuk cek status">
                        <button onclick="checkStatusManual()" class="bg-slate-800 hover:bg-slate-700 px-4 rounded-lg text-[10px] font-bold transition">CEK STATUS</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Konfigurasi API 100% sama dengan index (1).html
        const KHFY_CONFIG = {
            apiKey: "8F1199C1-483A-4C96-825E-F5EBD33AC60A",
            baseUrl: "https://panel.khfy-store.com/api_v2"
        };
        const ICS_CONFIG = {
            apiKey: "dcc0a69aa74abfde7b1bc5d252d858cb2fc5e32192da06a3",
            baseUrl: "https://reseller.ics-store.my.id"
        };

        // Urutan Proxy untuk stabilitas
        const PROXY_LIST = [
            "https://api.codetabs.com/v1/proxy?quest=",
            "https://corsproxy.io/?",
            "https://api.allorigins.win/raw?url="
        ];

        function log(msg, type = 'info') {
            const consoleLog = document.getElementById('consoleLog');
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ":" + 
                            now.getMinutes().toString().padStart(2, '0') + ":" + 
                            now.getSeconds().toString().padStart(2, '0');
            
            const div = document.createElement('div');
            div.innerHTML = `<span class="log-time">[${timeStr}]</span> <span class="log-${type}">${msg}</span>`;
            consoleLog.appendChild(div);
            consoleLog.scrollTop = consoleLog.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('consoleLog').innerHTML = '<div class="log-info">-- Console Cleared --</div>';
        }

        async function fetchWithProxy(targetUrl) {
            let lastError = "";
            for (const proxy of PROXY_LIST) {
                try {
                    log(`Mencoba via proxy: ${proxy.split('/')[2]}...`, 'info');
                    const response = await fetch(proxy + encodeURIComponent(targetUrl));
                    if (response.ok) {
                        const text = await response.text();
                        return JSON.parse(text);
                    }
                } catch (e) {
                    lastError = e.message;
                    log(`Gagal via ${proxy.split('/')[2]}: ${e.message}`, 'warning');
                }
            }
            throw new Error("Semua proxy gagal. " + lastError);
        }

        async function executeBypass(system) {
            const num = document.getElementById('targetNum').value;
            const code = document.getElementById('productCode').value;

            if (!num || !code) {
                alert("Nomor dan SKU wajib diisi!");
                return;
            }

            const reffId = `BYPASS-${Date.now()}`;
            log(`Mengeksekusi ${system} - SKU: ${code}, Target: ${num}`, 'warning');
            log(`Reff ID: ${reffId}`, 'info');

            let targetUrl = "";
            if (system === 'KHFY') {
                targetUrl = `${KHFY_CONFIG.baseUrl}/trx?api_key=${KHFY_CONFIG.apiKey}&produk=${code}&tujuan=${num}&reff_id=${reffId}`;
            } else {
                targetUrl = `${ICS_CONFIG.baseUrl}/?action=createTransaction&apikey=${ICS_CONFIG.apiKey}&kode_produk=${code}&nomor_tujuan=${num}&refid=${reffId}`;
            }

            try {
                const data = await fetchWithProxy(targetUrl);
                log(`RESPON: ${JSON.stringify(data)}`, data.status === true || data.success === true ? 'success' : 'error');
                
                if (data.status === true || data.success === true) {
                    alert(`BERHASIL!\nSistem: ${system}\nMsg: ${data.message || 'Transaksi diproses'}`);
                } else {
                    alert(`DITOLAK VENDOR!\nMsg: ${data.message || data.error || 'Gagal'}`);
                }
            } catch (err) {
                log(`FATAL ERROR: ${err.message}`, 'error');
                alert("Kesalahan Jaringan/Proxy. Cek Console.");
            }
        }

        async function checkStatusManual() {
            const reff = document.getElementById('checkReff').value;
            if (!reff) return alert("Masukkan Reff ID!");

            log(`Mengecek status Reff ID: ${reff}...`, 'warning');
            const targetUrl = `${KHFY_CONFIG.baseUrl}/history?api_key=${KHFY_CONFIG.apiKey}&refid=${reff}`;

            try {
                const data = await fetchWithProxy(targetUrl);
                log(`STATUS DATA: ${JSON.stringify(data)}`, 'info');
                
                let info = data.data || data;
                if(Array.isArray(info)) info = info[0];

                if(info) {
                    log(`STATUS AKHIR: ${info.status_text || info.status}`, 'success');
                    log(`SN/KET: ${info.sn || info.keterangan || '-'}`, 'success');
                }
            } catch (err) {
                log(`CEK STATUS GAGAL: ${err.message}`, 'error');
            }
        }
    </script>
</body>
</html>