<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Notifier Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f1f5f9; font-family: 'Segoe UI', sans-serif; }
        .hide { display: none; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-200">
        <div class="bg-blue-600 p-6 text-white text-center relative">
            <h1 class="text-2xl font-bold"><i class="fab fa-telegram-plane mr-2"></i>Bot Notifier</h1>
            <p class="text-blue-100 text-xs mt-1">Kirim Notifikasi Manual ke Telegram</p>
        </div>

        <div class="p-6 space-y-4">
            
            <div class="bg-gray-50 p-3 rounded-xl border border-gray-200 text-xs">
                <p class="font-bold text-gray-500 mb-2 uppercase tracking-wider">Konfigurasi Bot</p>
                <input type="text" id="botToken" placeholder="Bot Token (7507...)" class="w-full mb-2 p-2 border rounded" value="">
                <div class="flex gap-2">
                    <input type="text" id="chatId" placeholder="Chat ID (-100...)" class="w-2/3 p-2 border rounded" value="">
                    <input type="text" id="topicId" placeholder="Topic ID" class="w-1/3 p-2 border rounded" value="">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">Pilih Tipe Notifikasi</label>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setMode('topup')" id="btnTopup" class="py-2 px-4 rounded-xl font-bold text-sm bg-blue-600 text-white transition ring-2 ring-blue-600 ring-offset-1">
                        <i class="fas fa-wallet mr-1"></i> Top Up
                    </button>
                    <button onclick="setMode('trx')" id="btnTrx" class="py-2 px-4 rounded-xl font-bold text-sm bg-gray-100 text-gray-500 hover:bg-gray-200 transition">
                        <i class="fas fa-shopping-cart mr-1"></i> Transaksi
                    </button>
                </div>
            </div>

            <hr class="border-gray-100">

            <div id="formContainer" class="space-y-3 fade-in">
                <div id="fieldAmount" class="group-input">
                    <label class="text-xs font-bold text-gray-500">Nominal (Rp)</label>
                    <input type="number" id="inputAmount" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 font-bold text-gray-800" placeholder="Contoh: 50000">
                </div>

                <div id="fieldProduct" class="group-input hide">
                    <label class="text-xs font-bold text-gray-500">Nama Produk</label>
                    <input type="text" id="inputProduct" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 font-bold text-gray-800" placeholder="Contoh: Telkomsel 10GB">
                </div>

                <div id="fieldDest" class="group-input hide">
                    <label class="text-xs font-bold text-gray-500">Nomor Tujuan</label>
                    <input type="tel" id="inputDest" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 font-bold text-gray-800" placeholder="Contoh: 081234567890">
                </div>

                <div class="group-input">
                    <label class="text-xs font-bold text-gray-500">Username User</label>
                    <input type="text" id="inputUser" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 font-bold text-gray-800" placeholder="Contoh: user123">
                </div>

                <div class="group-input">
                    <label class="text-xs font-bold text-gray-500">TRX ID (Opsional)</label>
                    <input type="text" id="inputTrxId" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:border-blue-500 font-mono text-xs" placeholder="Otomatis jika kosong">
                </div>
            </div>

            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                <p class="text-[10px] font-bold text-blue-600 mb-1 uppercase">Preview Pesan:</p>
                <pre id="msgPreview" class="text-[10px] whitespace-pre-wrap font-mono text-gray-700">...</pre>
            </div>

            <button onclick="sendToTelegram()" id="btnSend" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30 transition active:scale-95 flex justify-center items-center gap-2">
                <span>KIRIM SEKARANG</span> <i class="fas fa-paper-plane"></i>
            </button>
            
            <p id="statusMsg" class="text-center text-xs font-bold mt-2 text-gray-400"></p>
        </div>
    </div>

    <script>
        // --- KONFIGURASI DEFAULT (ISI SESUAI FILE ANDA JIKA INGIN AUTO-FILL) ---
        const DEFAULT_CONFIG = {
            token: "7507761189:AAGUCYltzj_IMuDRgjUzUPiZDz4nbVXvOME", // Dari file upload anda
            chatId: "-1002997407612", // Dari file upload anda
            topupTopic: "7",  // Topic ID untuk Topup
            trxTopic: "6"     // Topic ID untuk Transaksi
        };

        // --- PROXY LIST (Sama seperti di index.html anda agar works client-side) ---
        const PROXY_LIST = [
            { name: 'CorsProxyIO', url: 'https://corsproxy.io/?' },
            { name: 'CodeTabs', url: 'https://api.codetabs.com/v1/proxy?quest=' },
            { name: 'ThingProxy', url: 'https://thingproxy.freeboard.io/fetch/' },
            { name: 'Direct', url: '' } // Fallback
        ];

        // --- STATE VARIABLES ---
        let currentMode = 'topup';

        // --- INITIALIZATION ---
        window.onload = () => {
            document.getElementById('botToken').value = DEFAULT_CONFIG.token;
            document.getElementById('chatId').value = DEFAULT_CONFIG.chatId;
            document.getElementById('topicId').value = DEFAULT_CONFIG.topupTopic;
            updatePreview();
        };

        // --- FUNGSI UI ---
        function setMode(mode) {
            currentMode = mode;
            const btnTopup = document.getElementById('btnTopup');
            const btnTrx = document.getElementById('btnTrx');
            const fieldProduct = document.getElementById('fieldProduct');
            const fieldDest = document.getElementById('fieldDest');
            const topicInput = document.getElementById('topicId');

            if(mode === 'topup') {
                // Style Active Topup
                btnTopup.className = "py-2 px-4 rounded-xl font-bold text-sm bg-blue-600 text-white transition ring-2 ring-blue-600 ring-offset-1";
                btnTrx.className = "py-2 px-4 rounded-xl font-bold text-sm bg-gray-100 text-gray-500 hover:bg-gray-200 transition";
                
                // Toggle Fields
                fieldProduct.classList.add('hide');
                fieldDest.classList.add('hide');
                
                // Set Default Topic
                topicInput.value = DEFAULT_CONFIG.topupTopic;
            } else {
                // Style Active Trx
                btnTrx.className = "py-2 px-4 rounded-xl font-bold text-sm bg-green-600 text-white transition ring-2 ring-green-600 ring-offset-1";
                btnTopup.className = "py-2 px-4 rounded-xl font-bold text-sm bg-gray-100 text-gray-500 hover:bg-gray-200 transition";

                // Toggle Fields
                fieldProduct.classList.remove('hide');
                fieldDest.classList.remove('hide');

                // Set Default Topic
                topicInput.value = DEFAULT_CONFIG.trxTopic;
            }
            updatePreview();
        }

        function formatRp(angka) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(angka);
        }

        // Generate Message Text
        function generateMessage() {
            const amount = document.getElementById('inputAmount').value || 0;
            const user = document.getElementById('inputUser').value || 'User';
            const trxId = document.getElementById('inputTrxId').value || (currentMode === 'topup' ? 'TOPUP-' : 'TRX-') + Date.now();
            
            // Format Tanggal
            const now = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const dateStr = now.toLocaleDateString('id-ID', options).replace(/ pukul /g, ' | ');

            if (currentMode === 'topup') {
                return `‚úÖ DEPOSIT BERHASIL \n` +
                       `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                       `üí≥ Jumlah : ${formatRp(amount).replace('Rp', 'Rp ')}\n` +
                       `üïí Waktu : ${dateStr}\n` +
                       `üë§ User ID : ${user}\n` +
                       `üìå Status : BERHASIL\n` +
                       `üÜî ID Transaksi :\n` +
                       `${trxId}\n` +
                       `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                       `üè¢ PANDAWA SYSTEM\n` +
                       `https://www.pandawa-digital.store`;
            } else {
                const product = document.getElementById('inputProduct').value || '-';
                const dest = document.getElementById('inputDest').value || '-';
                
                // Sensor nomor tujuan (4 digit terakhir)
                let safeDest = dest;
                if(dest.length > 4) safeDest = dest.substring(0, dest.length - 4) + "****";

                return `‚úÖ TRANSAKSI BERHASIL \n` +
                       `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                       `üì¶ Produk : ${product}\n` +
                       `üéØ Tujuan : ${safeDest}\n` +
                       `üí∏ Harga : ${formatRp(amount).replace('Rp', 'Rp ')}\n` +
                       `üïí Waktu : ${dateStr}\n` +
                       `üë§ User : ${user}\n` +
                       `üÜî TRX ID : ${trxId}\n` +
                       `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                       `üè¢ PANDAWA SYSTEM\n` +
                       `https://www.pandawa-digital.store`;
            }
        }

        // Live Preview Updater
        function updatePreview() {
            document.getElementById('msgPreview').innerText = generateMessage();
        }
        
        // Add Event Listeners for Live Preview
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', updatePreview);
        });

        // --- LOGIKA PENGIRIMAN (FETCH + PROXY) ---
        async function sendToTelegram() {
            const token = document.getElementById('botToken').value;
            const chat_id = document.getElementById('chatId').value;
            const message_thread_id = document.getElementById('topicId').value;
            const text = generateMessage();
            const btn = document.getElementById('btnSend');
            const status = document.getElementById('statusMsg');

            if(!token || !chat_id) return alert("Token Bot dan Chat ID wajib diisi!");

            // UI Loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';
            status.innerText = "Mencoba menghubungi server...";

            // Construct URL
            const baseUrl = `https://api.telegram.org/bot${token}/sendMessage`;
            const params = new URLSearchParams({
                chat_id: chat_id,
                text: text,
                message_thread_id: message_thread_id // Optional: kalau kirim ke topic
            });
            const targetUrl = `${baseUrl}?${params.toString()}`;

            let success = false;

            // Loop Proxy (Fallback System)
            for (const proxy of PROXY_LIST) {
                try {
                    status.innerText = `Mencoba jalur: ${proxy.name}...`;
                    const fullUrl = proxy.url ? proxy.url + encodeURIComponent(targetUrl) : targetUrl;
                    
                    const res = await fetch(fullUrl);
                    if(res.ok) {
                        success = true;
                        break;
                    }
                } catch (e) {
                    console.warn(`Gagal via ${proxy.name}`, e);
                }
            }

            // Restore UI
            btn.disabled = false;
            btn.innerHTML = '<span>KIRIM SEKARANG</span> <i class="fas fa-paper-plane"></i>';

            if(success) {
                status.innerText = "‚úÖ Pesan Terkirim!";
                status.className = "text-center text-xs font-bold mt-2 text-green-600";
                setTimeout(() => { status.innerText = ""; }, 3000);
            } else {
                status.innerText = "‚ùå Gagal Kirim (Cek Koneksi/Token)";
                status.className = "text-center text-xs font-bold mt-2 text-red-500";
            }
        }
    </script>
</body>
</html>