<!DOCTYPE html>
<html lang="id" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DompetKu - Updated Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <style>
        /* --- Base Styles --- */
        body { font-family: 'Inter', 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        .app-container {
            max-width: 480px; margin: 0 auto; min-height: 100vh;
            position: relative; box-shadow: 0 0 25px rgba(0,0,0,0.05); overflow-x: hidden; padding-bottom: 90px;
        }
        
        /* Theme Colors */
        body { background-color: #f8fafc; }
        .app-container { background-color: #ffffff; }
        html.dark body { background-color: #111827; } 
        html.dark .app-container { background-color: #030712; box-shadow: 0 0 25px rgba(0,0,0,0.5); } 
        
        /* Utilities */
        .hide { display: none !important; }
        .page { animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal Animation */
        .modal-enter { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .fade-enter { animation: fadeInOp 0.2s ease-out forwards; }
        @keyframes fadeInOp { from { opacity: 0; } to { opacity: 1; } }

        .bg-gradient-brand { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); }
        html.dark .bg-gradient-brand { background: linear-gradient(135deg, #1d4ed8 0%, #172554 100%); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .input-group { position: relative; }
        .input-group i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; transition: 0.3s; z-index: 10;}
        .input-group input:focus + i { color: #2563eb; }
        .input-group input { padding-left: 44px; transition: all 0.3s; }
        html.dark .input-group i { color: #6b7280; }
        html.dark .input-group input:focus + i { color: #60a5fa; }

        /* Provider Select List Style */
        .provider-list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; border-bottom: 1px solid #f3f4f6; cursor: pointer;
        }
        html.dark .provider-list-item { border-bottom-color: #374151; }
        .provider-list-item:last-child { border-bottom: none; }
        
        /* Custom Radio Button */
        .custom-radio {
            width: 20px; height: 20px; border: 2px solid #cbd5e1; border-radius: 50%;
            position: relative; display: flex; align-items: center; justify-content: center;
        }
        html.dark .custom-radio { border-color: #4b5563; }
        .provider-list-item.selected .custom-radio { border-color: #2563eb; }
        .provider-list-item.selected .custom-radio::after {
            content: ''; width: 10px; height: 10px; background-color: #2563eb; border-radius: 50%;
        }

        /* ATM Card */
        .atm-card {
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
            border-radius: 20px; color: white; position: relative; overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        /* QRIS Button */
        .qris-btn-container { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; }
        .qris-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 2px 10px rgba(220, 38, 38, 0.3);
            border: 2px solid white;
        }
        html.dark .qris-btn { border-color: #1f2937; }
    </style>
</head>
<body>

<div class="app-container transition-colors duration-300">

    <div id="customConfirmModal" class="hide fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 fade-enter">
        <div class="bg-white dark:bg-gray-900 w-full max-w-xs rounded-3xl p-6 shadow-2xl transform transition-all scale-100">
            <div class="text-center mb-4">
                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-question text-2xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-1" id="confirmTitle">Konfirmasi</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400" id="confirmMessage">Apakah anda yakin?</p>
            </div>
            <div class="flex gap-3">
                <button onclick="closeConfirm(false)" class="flex-1 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 font-semibold text-sm hover:bg-gray-50 dark:hover:bg-gray-800 transition">Batal</button>
                <button id="confirmYesBtn" class="flex-1 py-2.5 rounded-xl bg-blue-600 text-white font-semibold text-sm shadow-lg shadow-blue-500/30 hover:bg-blue-700 transition">Ya, Lanjutkan</button>
            </div>
        </div>
    </div>

    <div id="providerSelectorModal" class="hide fixed inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 fade-enter">
        <div class="bg-white dark:bg-gray-900 w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden">
            <div class="p-4 border-b border-gray-100 dark:border-gray-800">
                <h3 class="text-gray-500 dark:text-gray-400 font-medium">-- Pilih Provider --</h3>
            </div>
            <div id="providerListContainer" class="max-h-[60vh] overflow-y-auto"></div>
            <div class="p-3 bg-gray-50 dark:bg-gray-800 text-right">
                <button onclick="document.getElementById('providerSelectorModal').classList.add('hide')" class="text-blue-600 dark:text-blue-400 font-bold text-sm px-4 py-2">TUTUP</button>
            </div>
        </div>
    </div>

    <div id="topUpSheet" class="hide fixed inset-0 z-50 flex flex-col justify-end bg-black/60 backdrop-blur-sm">
        <div class="bg-white dark:bg-gray-900 w-full rounded-t-[30px] p-6 modal-enter max-w-[480px] mx-auto">
            <div class="w-12 h-1.5 bg-gray-300 dark:bg-gray-700 rounded-full mx-auto mb-6"></div>
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Pilih Metode Top Up</h3>
            <div class="space-y-3">
                <div onclick="processTopUp('manual')" class="flex items-center gap-4 p-4 rounded-2xl border border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                    <div class="w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center"><i class="fas fa-hand-holding-usd"></i></div>
                    <div class="flex-1"><h4 class="font-bold text-gray-800 dark:text-white text-sm">Manual (Simulasi)</h4><p class="text-xs text-gray-500">Isi saldo instan untuk testing</p></div><i class="fas fa-chevron-right text-gray-300"></i>
                </div>
                <div onclick="processTopUp('qris')" class="flex items-center gap-4 p-4 rounded-2xl border border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                    <div class="w-10 h-10 bg-red-100 text-red-600 rounded-full flex items-center justify-center"><i class="fas fa-qrcode"></i></div>
                    <div class="flex-1"><h4 class="font-bold text-gray-800 dark:text-white text-sm">QRIS Otomatis</h4><p class="text-xs text-gray-500">Scan QRIS dari merchant lain</p></div><i class="fas fa-chevron-right text-gray-300"></i>
                </div>
                <div onclick="showBankList()" class="flex items-center gap-4 p-4 rounded-2xl border border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center"><i class="fas fa-university"></i></div>
                    <div class="flex-1"><h4 class="font-bold text-gray-800 dark:text-white text-sm">Transfer Bank</h4><p class="text-xs text-gray-500">BCA, Mandiri, BRI, BNI, dll</p></div><i class="fas fa-chevron-right text-gray-300"></i>
                </div>
            </div>
            <button onclick="closeTopUp()" class="mt-6 w-full py-3 text-gray-500 dark:text-gray-400 font-semibold text-sm">Tutup</button>
        </div>
    </div>

    <section id="bankListPage" class="page hide bg-white dark:bg-gray-950 min-h-screen z-[60] absolute top-0 w-full max-w-[480px]">
        <div class="p-4 border-b dark:border-gray-800 flex items-center shadow-sm bg-white dark:bg-gray-900 sticky top-0">
            <button onclick="closeBankList()" class="mr-4 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800"><i class="fas fa-arrow-left text-gray-800 dark:text-white"></i></button>
            <h2 class="font-bold text-lg text-gray-800 dark:text-white">Pilih Bank</h2>
        </div>
        <div class="p-4" id="bankListContainer"></div>
    </section>

    <section id="loginPage" class="page flex flex-col justify-between min-h-screen bg-white dark:bg-gray-950 relative z-50">
        <div class="absolute top-0 left-0 w-full h-[45vh] bg-gradient-brand rounded-b-[50px] z-0"></div>
        <div class="relative z-10 px-8 pt-20 w-full">
            <div class="text-center mb-8 text-white">
                <div class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg border border-white/30">
                    <i class="fas fa-wallet text-4xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold tracking-tight">DompetKu</h1>
                <p class="text-blue-100 text-sm mt-1">Super Payment App</p>
            </div>
            <div class="bg-white dark:bg-gray-900 p-8 rounded-3xl shadow-xl shadow-blue-900/10 dark:shadow-black/30">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6 text-center">Masuk Akun</h2>
                <div class="space-y-4">
                    <div class="input-group">
                        <input type="text" id="usernameInput" value="tes" placeholder="Username" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-gray-800 text-gray-700 dark:text-gray-100 text-sm font-medium">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="input-group">
                        <input type="password" id="passwordInput" value="tes" placeholder="Kata Sandi" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-gray-800 text-gray-700 dark:text-gray-100 text-sm font-medium">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="alert('Link reset password telah dikirim ke email anda.')" class="text-xs text-blue-600 dark:text-blue-400 font-semibold hover:underline">Lupa Kata Sandi?</button>
                    </div>
                    <button onclick="handleLogin()" class="w-full bg-blue-600 dark:bg-blue-500 text-white h-12 rounded-xl font-bold shadow-lg shadow-blue-500/30 active:scale-95 transition-transform hover:bg-blue-700 mt-2">MASUK</button>
                </div>
            </div>
        </div>
        <div class="relative z-10 p-8 text-center">
            <p class="text-gray-500 dark:text-gray-400 text-sm">Belum punya akun?</p>
            <button onclick="nav('registerPage')" class="mt-2 text-blue-600 dark:text-blue-400 font-bold text-sm hover:underline">Daftar Sekarang</button>
        </div>
    </section>

    <section id="registerPage" class="page hide flex flex-col min-h-screen bg-white dark:bg-gray-950 relative z-50">
        <div class="p-4 flex items-center">
            <button onclick="nav('loginPage')" class="mr-4 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800"><i class="fas fa-arrow-left text-gray-800 dark:text-white"></i></button>
            <h2 class="font-bold text-xl text-gray-800 dark:text-white">Daftar Akun Baru</h2>
        </div>
        <div class="px-6 py-4 flex-1 overflow-y-auto pb-10">
            <p class="text-sm text-gray-500 mb-6">Lengkapi data diri anda untuk mulai menggunakan DompetKu.</p>
            <div class="space-y-4">
                <div class="input-group">
                    <input type="text" id="regUsername" placeholder="Username" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-12">
                    <i class="fas fa-user ml-1"></i>
                </div>
                <div class="input-group">
                    <input type="email" id="regEmail" placeholder="Email Aktif" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-12">
                    <i class="fas fa-envelope ml-1"></i>
                </div>
                <div class="input-group">
                    <div class="absolute left-4 top-1/2 -translate-y-1/2 flex items-center gap-2 z-10">
                        <span class="text-sm font-bold text-gray-500 dark:text-gray-400">+62</span>
                        <div class="w-[1px] h-4 bg-gray-300"></div>
                    </div>
                    <input type="tel" id="regPhone" placeholder="812-3456-7890" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium" style="padding-left: 60px;">
                </div>
                <div class="input-group">
                    <input type="password" id="regPass" placeholder="Kata Sandi" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-12">
                    <i class="fas fa-lock ml-1"></i>
                </div>
                <div class="input-group">
                    <input type="password" id="regPassConfirm" placeholder="Ulangi Kata Sandi" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-12">
                    <i class="fas fa-check-circle ml-1"></i>
                </div>
                <div class="input-group">
                    <input type="text" id="regReferral" placeholder="Kode Referral (Opsional)" class="w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-12">
                    <i class="fas fa-tag ml-1"></i>
                </div>
                <div class="pt-4">
                    <button onclick="handleRegister()" class="w-full bg-blue-600 text-white h-12 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition">DAFTAR SEKARANG</button>
                    <p class="text-center text-xs text-gray-400 mt-4">Dengan mendaftar, anda menyetujui S&K yang berlaku.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="settingsPage" class="page hide bg-gray-50 dark:bg-gray-950 min-h-screen relative z-50">
        <div class="p-4 bg-white dark:bg-gray-900 sticky top-0 z-20 shadow-sm flex items-center gap-4">
            <button onclick="nav('profilePage')" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition"><i class="fas fa-arrow-left text-gray-800 dark:text-white"></i></button>
            <h2 class="font-bold text-lg text-gray-800 dark:text-white">Pengaturan Akun</h2>
        </div>
        <div class="p-6 pb-24">
            <div class="bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 space-y-5">
                <div><label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-1">Username</label><div class="input-group"><input type="text" id="setUsername" class="w-full h-11 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-10"><i class="fas fa-user ml-[-5px]"></i></div></div>
                <div><label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-1">Email</label><div class="input-group"><input type="email" id="setEmail" class="w-full h-11 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-10"><i class="fas fa-envelope ml-[-5px]"></i></div></div>
                <div><label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-1">Nomor Handphone</label><div class="input-group"><input type="tel" id="setPhone" class="w-full h-11 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-10"><i class="fas fa-phone ml-[-5px]"></i></div></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-1">Umur</label><div class="input-group"><input type="number" id="setAge" class="w-full h-11 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-10"><i class="fas fa-birthday-cake ml-[-5px]"></i></div></div>
                    <div><label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-1">Jenis Kelamin</label><select id="setGender" class="w-full h-11 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-2"><option value="Laki-laki">Laki-laki</option><option value="Perempuan">Perempuan</option></select></div>
                </div>
                <div class="pt-2"><button onclick="changePassword()" class="w-full py-3 border border-red-200 dark:border-red-900/50 text-red-500 dark:text-red-400 rounded-lg font-bold text-sm hover:bg-red-50 dark:hover:bg-red-900/20 transition"><i class="fas fa-key mr-2"></i> Ganti Kata Sandi</button></div>
            </div>
            <button onclick="saveSettings()" class="w-full bg-blue-600 text-white h-12 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition mt-6">SIMPAN PERUBAHAN</button>
        </div>
    </section>

    <section id="homePage" class="page hide bg-gray-50/50 dark:bg-gray-950">
        <div class="bg-gradient-brand text-white pt-8 pb-24 px-6 rounded-b-[40px] shadow-lg relative overflow-hidden">
            <div class="flex justify-between items-center mb-6 relative z-10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full border-2 border-white/30 p-0.5"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" class="w-full h-full rounded-full bg-white dark:bg-gray-800"></div>
                    <div><p class="text-xs text-blue-100">Selamat Pagi,</p><p class="font-bold text-lg leading-tight" id="headerUsername">User Test</p></div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-full bg-white/20 backdrop-blur flex items-center justify-center hover:bg-white/30 transition active:scale-95"><i id="themeIcon" class="fas fa-moon text-white"></i></button>
                    <div class="relative"><i class="fas fa-bell text-xl"></i><span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-blue-600 dark:border-blue-800"></span></div>
                </div>
            </div>
        </div>

        <div class="mx-6 -mt-20 relative z-20">
            <div class="bg-white dark:bg-gray-900 rounded-3xl p-5 shadow-xl shadow-blue-900/5 dark:shadow-black/20">
                <div class="flex justify-between items-start mb-2">
                    <div><p class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider">Total Saldo</p><h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mt-1" id="displayBalance">Rp 0</h2></div>
                    <div class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg flex items-center justify-center"><i class="fas fa-wallet text-sm"></i></div>
                </div>
                <div class="flex justify-between mt-6 border-t border-gray-100 dark:border-gray-800 pt-5">
                    <div class="text-center group cursor-pointer" onclick="openTopUpSheet()"><div class="action-btn"><i class="fas fa-plus"></i></div><span class="action-text">Top Up</span></div>
                    <div class="text-center group cursor-pointer"><div class="action-btn"><i class="fas fa-paper-plane"></i></div><span class="action-text">Kirim</span></div>
                    <div class="text-center group cursor-pointer"><div class="action-btn"><i class="fas fa-arrow-down"></i></div><span class="action-text">Minta</span></div>
                    <div class="text-center group cursor-pointer"><div class="action-btn"><i class="fas fa-grid-2"></i></div><span class="action-text">Lainnya</span></div>
                </div>
            </div>
        </div>

        <div class="mt-6 px-6">
            <h3 class="font-bold text-gray-800 dark:text-white mb-4 text-sm">Pembayaran & Tagihan</h3>
            <div class="grid grid-cols-4 gap-4">
                <div class="text-center group cursor-pointer" onclick="openPPOB('pulsa')">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-orange-200 transition-all"><i class="fas fa-mobile-alt text-orange-500 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">Pulsa</span>
                </div>
                
                <div class="text-center group cursor-pointer" onclick="openXLAkrab()">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-blue-200 transition-all"><i class="fas fa-users text-blue-600 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">XL Akrab</span>
                </div>

                <div class="text-center group cursor-pointer" onclick="alert('Fitur Paket OTP segera hadir!')">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-emerald-200"><i class="fas fa-comment-dots text-emerald-500 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">Paket OTP</span>
                </div>

                <div class="text-center group cursor-pointer" onclick="alert('Fitur Pre-ORDER segera hadir!')">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-purple-200"><i class="fas fa-box-open text-purple-600 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">Pre-ORDER</span>
                </div>

                <div class="text-center group cursor-pointer" onclick="alert('Fitur REG Kartu segera hadir!')">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-cyan-200"><i class="fas fa-address-card text-cyan-500 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">REG Kartu</span>
                </div>

                <div class="text-center group cursor-pointer" onclick="alert('Fitur Login OTP segera hadir!')">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-teal-200"><i class="fas fa-key text-teal-500 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">Login OTP</span>
                </div>

                <div class="text-center group cursor-pointer" onclick="nav('historyPage')">
                    <div class="bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 w-14 h-14 rounded-2xl mx-auto flex items-center justify-center shadow-sm dark:shadow-gray-800 mb-2 group-hover:border-indigo-200"><i class="fas fa-file-invoice-dollar text-indigo-500 text-xl"></i></div><span class="text-[10px] font-medium text-gray-600 dark:text-gray-400">Mutasi</span>
                </div>
            </div>
        </div>
        
        <div class="mt-8 bg-white dark:bg-gray-900 rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.03)] dark:shadow-[0_-5px_20px_rgba(0,0,0,0.2)] p-6 min-h-[300px]">
            <div class="flex justify-between items-end mb-4">
                <h3 class="font-bold text-gray-800 dark:text-white">Transaksi Terakhir</h3>
                <span class="text-xs text-blue-600 dark:text-blue-400 font-semibold cursor-pointer">Lihat Semua</span>
            </div>
            <div id="miniHistory" class="space-y-4"></div>
        </div>
    </section>

    <section id="xlAkrabPage" class="page hide bg-gray-50 dark:bg-gray-950 min-h-screen z-40 absolute top-0 w-full max-w-[480px]">
        <div class="p-4 bg-white dark:bg-gray-900 sticky top-0 z-20 shadow-sm flex items-center gap-4">
            <button onclick="nav('homePage')" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition"><i class="fas fa-arrow-left text-gray-800 dark:text-white"></i></button>
            <h2 class="font-bold text-lg text-gray-800 dark:text-white">Transaksi XL Akrab</h2>
        </div>
        <div class="p-6 pb-24">
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-2">Provider</label>
                <div class="relative cursor-pointer" onclick="openProviderSelector()">
                    <input type="text" id="xlProviderInput" placeholder="-- Pilih Provider --" readonly class="w-full h-12 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none text-gray-700 dark:text-gray-100 text-sm font-medium pl-4 cursor-pointer">
                    <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            <div class="mb-4">
                <label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-2">Produk</label>
                <div class="relative">
                    <select id="xlProductInput" class="w-full h-12 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-4 appearance-none"><option value="">-- Pilih Provider Terlebih Dahulu --</option></select>
                    <i class="fas fa-box absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-2">Nomor Tujuan</label>
                <div class="relative">
                    <input type="tel" id="xlDestNumber" placeholder="Nomor XL / Tujuan" class="w-full h-12 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-100 text-sm font-medium pl-10">
                    <i class="fas fa-phone absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            <button onclick="processXLPurchase()" class="w-full bg-blue-600 text-white h-12 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition">LANJUTKAN</button>
        </div>
    </section>

    <section id="ppobPage" class="page hide bg-gray-50 dark:bg-gray-950 min-h-screen z-40 absolute top-0 w-full max-w-[480px]">
        <div class="p-4 bg-white dark:bg-gray-900 sticky top-0 z-20 shadow-sm flex items-center gap-4">
            <button onclick="closePPOB()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition"><i class="fas fa-arrow-left text-gray-800 dark:text-white"></i></button>
            <h2 class="font-bold text-lg text-gray-800 dark:text-white" id="ppobTitle">Isi Pulsa</h2>
        </div>
        <div class="p-4 pb-24">
            <div class="mb-6">
                <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-3 px-1">1. Pilih Operator</h3>
                <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2" id="providerList"></div>
            </div>
            <div id="inputSection" class="hide transition-all duration-300">
                <div class="bg-white dark:bg-gray-900 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 mb-6">
                    <label class="block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-2">2. Masukkan Nomor Handphone</label>
                    <div class="flex items-center gap-3">
                        <input type="tel" id="ppobNumber" placeholder="08xx-xxxx-xxxx" class="flex-1 bg-transparent text-xl font-bold text-gray-800 dark:text-white outline-none placeholder-gray-300 dark:placeholder-gray-700" oninput="detectProvider()">
                        <i class="fas fa-address-book text-blue-600 dark:text-blue-400 text-xl cursor-pointer"></i>
                    </div>
                </div>
                <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-3 px-1" id="productListTitle">3. Pilihan Paket</h3>
                <div class="grid gap-3" id="productList"></div>
            </div>
            <div id="instructionText" class="text-center mt-10 text-gray-400 dark:text-gray-600"><i class="fas fa-hand-pointer text-4xl mb-2 opacity-50"></i><p class="text-sm">Silakan pilih operator seluler terlebih dahulu</p></div>
        </div>
    </section>

    <section id="historyPage" class="page hide bg-gray-50 dark:bg-gray-950 min-h-screen">
        <div class="p-4 bg-white dark:bg-gray-900 sticky top-0 z-10 shadow-sm dark:shadow-gray-800 flex justify-between items-center">
            <h2 class="font-bold text-lg text-gray-800 dark:text-white">Riwayat</h2>
            <i class="fas fa-filter text-gray-500 dark:text-gray-400"></i>
        </div>
        <div id="fullHistory" class="p-4 space-y-3 pb-24"></div>
    </section>

    <section id="walletPage" class="page hide bg-gray-50 dark:bg-gray-950 min-h-screen">
        <div class="p-4 bg-white dark:bg-gray-900 sticky top-0 z-10 shadow-sm dark:shadow-gray-800 transition-colors">
            <h2 class="font-bold text-lg text-gray-800 dark:text-white">Dompet Saya</h2>
        </div>
        <div class="p-6 pb-24">
            <div class="atm-card p-6 mb-8 transform transition hover:scale-[1.02] duration-300">
                <div class="flex justify-between items-start mb-8"><i class="fas fa-sim-card text-3xl opacity-80"></i><i class="fas fa-wifi text-2xl opacity-50 rotate-90"></i></div>
                <p class="text-xl tracking-widest font-mono mb-4 font-bold drop-shadow-md">4200 1234 5678 9010</p>
                <div class="flex justify-between items-end"><div><p class="text-[9px] opacity-70 uppercase tracking-wider mb-1">Card Holder</p><p class="text-sm font-bold uppercase" id="cardHolder">USER TEST</p></div><div><p class="text-[9px] opacity-70 uppercase tracking-wider mb-1">Expires</p><p class="text-sm font-bold">12/28</p></div></div>
            </div>
            <h3 class="text-sm font-bold text-gray-700 dark:text-gray-300 mb-3 transition-colors">Metode Terhubung</h3>
            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 p-4 mb-3 flex items-center justify-between transition-colors">
                <div class="flex items-center gap-4"><div class="w-10 h-10 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600 dark:text-blue-400 transition-colors"><i class="fas fa-university"></i></div><div><p class="font-bold text-sm text-gray-800 dark:text-white transition-colors">Bank BCA</p><p class="text-xs text-gray-400 dark:text-gray-500 transition-colors">Debit •••• 8890</p></div></div><span class="bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-[10px] font-bold px-2 py-1 rounded border border-green-100 dark:border-green-800 transition-colors">UTAMA</span>
            </div>
            <button class="w-full py-4 rounded-2xl border-2 border-dashed border-gray-300 dark:border-gray-700 text-gray-400 dark:text-gray-500 font-semibold text-sm hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors"><i class="fas fa-plus mr-2"></i> Tambah Kartu Baru</button>
        </div>
    </section>

    <section id="profilePage" class="page hide bg-gray-50 dark:bg-gray-950 min-h-screen">
        <div class="bg-gradient-brand text-white p-6 pb-12 rounded-b-[40px] text-center shadow-lg relative transition-colors">
            <div class="w-24 h-24 bg-white dark:bg-gray-900 p-1 rounded-full mx-auto mb-4 shadow-xl transition-colors"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" class="w-full h-full rounded-full bg-gray-100 dark:bg-gray-800"></div>
            <h2 class="text-xl font-bold" id="profileName">User Test</h2><p class="text-blue-200 text-sm" id="profilePhone">0812-3456-7890</p>
            <div class="mt-4 inline-flex items-center bg-blue-800/50 dark:bg-blue-900/50 backdrop-blur px-4 py-1.5 rounded-full text-xs font-semibold border border-blue-400/30"><i class="fas fa-crown text-yellow-400 mr-2"></i> Member Premium</div>
        </div>
        <div class="px-6 -mt-6 pb-24 relative z-10">
            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg shadow-gray-200/50 dark:shadow-black/30 overflow-hidden transition-colors">
                <div onclick="nav('settingsPage'); loadSettings()" class="p-4 border-b border-gray-50 dark:border-gray-800 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors"><div class="w-9 h-9 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center"><i class="fas fa-user-cog text-sm"></i></div><div class="flex-1 text-sm font-semibold text-gray-700 dark:text-white">Pengaturan Akun</div><i class="fas fa-chevron-right text-gray-300 dark:text-gray-600 text-xs"></i></div>
                <div class="p-4 border-b border-gray-50 dark:border-gray-800 flex items-center gap-4 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors"><div class="w-9 h-9 rounded-full bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 flex items-center justify-center"><i class="fas fa-shield-alt text-sm"></i></div><div class="flex-1 text-sm font-semibold text-gray-700 dark:text-white">Keamanan & Privasi</div><i class="fas fa-chevron-right text-gray-300 dark:text-gray-600 text-xs"></i></div>
                <div onclick="handleLogout()" class="p-4 flex items-center gap-4 hover:bg-red-50 dark:hover:bg-red-900/20 cursor-pointer transition-colors group"><div class="w-9 h-9 rounded-full bg-red-50 dark:bg-red-900/30 text-red-500 dark:text-red-400 group-hover:bg-red-100 dark:group-hover:bg-red-900/50 flex items-center justify-center transition-colors"><i class="fas fa-sign-out-alt text-sm"></i></div><div class="flex-1 text-sm font-bold text-red-500 dark:text-red-400">Keluar</div></div>
            </div>
        </div>
    </section>

    <section id="scanPage" class="page hide bg-black min-h-screen text-white flex flex-col fixed top-0 w-full max-w-[480px] z-50">
        <div class="flex justify-between items-center p-4 absolute top-0 w-full z-10">
            <button onclick="stopScan()" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-times"></i></button>
            <h2 class="font-bold">Scan QRIS</h2>
            <button class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-bolt"></i></button>
        </div>
        <div class="flex-1 flex flex-col justify-center items-center relative">
            <div id="reader" class="rounded-3xl overflow-hidden border-2 border-white/50 shadow-2xl"></div>
            <div class="absolute bottom-32 text-center pointer-events-none"><p class="text-sm font-medium bg-black/40 px-4 py-1 rounded-full">Arahkan kamera ke kode QRIS</p></div>
        </div>
        <div class="p-8 bg-black/90 text-center pb-12">
            <button onclick="simulateSuccessScan()" class="bg-blue-600 px-8 py-3 rounded-full text-sm font-bold shadow-lg"><i class="fas fa-magic mr-2"></i>Simulasi Scan</button>
        </div>
    </section>

    <section id="paymentPage" class="page hide bg-white dark:bg-gray-950 min-h-screen z-50 absolute top-0 w-full max-w-[480px]">
         <div class="p-4 border-b dark:border-gray-800 flex items-center shadow-sm">
            <button onclick="cancelPayment()" class="mr-4 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800"><i class="fas fa-arrow-left text-gray-800 dark:text-white"></i></button>
            <h2 class="font-bold text-lg text-gray-800 dark:text-white">Bayar QRIS</h2>
        </div>
        <div class="p-6">
            <div class="flex items-center gap-4 mb-6 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-2xl border border-blue-100 dark:border-blue-900">
                <div class="w-12 h-12 bg-white dark:bg-gray-900 rounded-full flex items-center justify-center text-blue-600 font-bold"><i class="fas fa-store"></i></div>
                <div><h3 class="font-bold text-lg text-gray-800 dark:text-white" id="merchantName">Merchant</h3><p class="text-xs text-gray-500">ID: 93881</p></div>
            </div>
            <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Nominal</label>
            <div class="bg-white dark:bg-gray-900 p-2 rounded-xl mb-2 border-b-2 border-blue-500 flex items-center">
                <span class="text-2xl font-bold mr-2 text-gray-400">Rp</span>
                <input type="number" id="qrisAmount" placeholder="0" class="w-full bg-transparent text-4xl font-bold outline-none text-gray-800 dark:text-white">
            </div>
            <button onclick="processQrisPayment()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold mt-6 shadow-lg hover:bg-blue-700">BAYAR SEKARANG</button>
        </div>
    </section>

    <nav id="bottomNav" class="fixed bottom-0 left-0 right-0 max-w-[480px] mx-auto bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 flex justify-around items-end pb-4 pt-3 text-[10px] shadow-[0_-10px_40px_rgba(0,0,0,0.05)] z-40 hide rounded-t-3xl">
        <div class="text-center cursor-pointer w-1/5 nav-item text-blue-600 dark:text-blue-400 group" id="nav-home" onclick="nav('homePage')"><div class="mb-1 transition group-hover:-translate-y-1"><i class="fas fa-home text-xl"></i></div><p class="font-medium">Beranda</p></div>
        <div class="text-center cursor-pointer w-1/5 nav-item text-gray-400 dark:text-gray-500 group" id="nav-history" onclick="nav('historyPage')"><div class="mb-1 transition group-hover:-translate-y-1"><i class="fas fa-history text-xl"></i></div><p class="font-medium">Riwayat</p></div>
        <div class="text-center w-1/5 qris-btn-container cursor-pointer" onclick="startScan()"><div class="qris-btn w-11 h-11 rounded-full flex items-center justify-center mx-auto text-white transform transition hover:scale-105 hover:rotate-90 active:scale-95 mb-1"><i class="fas fa-qrcode text-lg"></i></div><p class="font-bold text-gray-700 dark:text-gray-400">Scan</p></div>
        <div class="text-center cursor-pointer w-1/5 nav-item text-gray-400 dark:text-gray-500 group" id="nav-wallet" onclick="nav('walletPage')"><div class="mb-1 transition group-hover:-translate-y-1"><i class="fas fa-wallet text-xl"></i></div><p class="font-medium">Dompet</p></div>
        <div class="text-center cursor-pointer w-1/5 nav-item text-gray-400 dark:text-gray-500 group" id="nav-profile" onclick="nav('profilePage')"><div class="mb-1 transition group-hover:-translate-y-1"><i class="fas fa-user text-xl"></i></div><p class="font-medium">Saya</p></div>
    </nav>
</div>

<style>
    .action-btn { width: 48px; height: 48px; margin: 0 auto 8px; background-color: #eff6ff; color: #2563eb; border-radius: 16px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    html.dark .action-btn { background-color: rgba(30, 58, 138, 0.2); color: #60a5fa; }
    .group:hover .action-btn { background-color: #2563eb; color: white; }
    html.dark .group:hover .action-btn { background-color: #3b82f6; color: white; }
    .action-text { font-size: 11px; font-weight: 600; color: #4b5563; }
    html.dark .action-text { color: #9ca3af; }
</style>

<script>
    // --- STATE MANAGEMENT ---
    let balance = 1400000;
    let userProfile = { username: 'User Test', email: 'user@dompetku.com', phone: '0812-3456-7890', age: 25, gender: 'Laki-laki' };
    let transactions = [
        { type: 'out', title: 'Starbucks Coffee', date: 'Hari ini, 14:00', amount: 55000, icon: 'fa-coffee', colorBg: 'bg-green-100 dark:bg-green-900/30', colorText: 'text-green-600 dark:text-green-400' },
        { type: 'in', title: 'Top Up BCA', date: 'Hari ini, 09:00', amount: 500000, icon: 'fa-university', colorBg: 'bg-blue-100 dark:bg-blue-900/30', colorText: 'text-blue-600 dark:text-blue-400' }
    ];
    let currentPPOBType = 'pulsa';
    let selectedProvider = null;

    // --- DATA ---
    const banks = [ { name: 'Bank BCA', code: 'BCA' }, { name: 'Bank Mandiri', code: 'MANDIRI' }, { name: 'Bank BRI', code: 'BRI' }, { name: 'Bank BNI', code: 'BNI' } ];
    const providers = [{id:'telkomsel',name:'Telkomsel',color:'text-red-600'},{id:'indosat',name:'Indosat (M3)',color:'text-yellow-500'},{id:'xl',name:'XL Axiata',color:'text-blue-600'}];
    const pulsaOptions = [5000, 10000, 20000, 50000, 100000];

    // --- DATA KHUSUS XL AKRAB ---
    const xlProvidersList = [
        'XL Akrab V1 (XLA)',
        'XL Akrab V2 (XDA)',
        'FLEX MAX (Wajib Cek Promo)',
        'XL Reguler (Support Semua Nomor XL)',
        'XL Data Circle',
        'Cek PLN'
    ];

    const xlProducts = {
        'XL Akrab V1 (XLA)': ['10GB + 2GB Bonus (Rp 25.000)', '20GB + 5GB Bonus (Rp 45.000)', '50GB + 10GB Bonus (Rp 90.000)'],
        'XL Akrab V2 (XDA)': ['15GB Family (Rp 35.000)', '30GB Family (Rp 60.000)'],
        'FLEX MAX (Wajib Cek Promo)': ['Flex S', 'Flex M', 'Flex L'],
        'XL Reguler (Support Semua Nomor XL)': ['Xtra Combo 10GB', 'Xtra Combo 20GB'],
        'XL Data Circle': ['Circle S', 'Circle M'],
        'Cek PLN': ['Token 20k', 'Token 50k']
    };

    // --- HELPER FUNCTIONS ---
    function formatRp(n) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n); }
    function toggleDarkMode() { document.documentElement.classList.toggle('dark'); const isDark = document.documentElement.classList.contains('dark'); document.getElementById('themeIcon').className = isDark ? 'fas fa-sun text-white' : 'fas fa-moon text-white'; localStorage.setItem('theme', isDark ? 'dark' : 'light'); }
    if(localStorage.getItem('theme') === 'dark') toggleDarkMode();

    function customConfirm(title, message, callback) { document.getElementById('confirmTitle').innerText = title; document.getElementById('confirmMessage').innerText = message; document.getElementById('customConfirmModal').classList.remove('hide'); confirmCallback = callback; }
    let confirmCallback = null;
    function closeConfirm(result) { document.getElementById('customConfirmModal').classList.add('hide'); if (result && confirmCallback) confirmCallback(); confirmCallback = null; }
    document.getElementById('confirmYesBtn').onclick = () => closeConfirm(true);

    // --- NAVIGATION ---
    function nav(pageId) {
        document.querySelectorAll('.page').forEach(el => { el.classList.add('hide'); });
        document.getElementById(pageId).classList.remove('hide');
        document.querySelectorAll('.nav-item').forEach(el => { el.classList.remove('text-blue-600', 'dark:text-blue-400'); el.classList.add('text-gray-400', 'dark:text-gray-500'); });
        const navId = 'nav-' + pageId.replace('Page','');
        if(document.getElementById(navId)) { document.getElementById(navId).classList.remove('text-gray-400', 'dark:text-gray-500'); document.getElementById(navId).classList.add('text-blue-600', 'dark:text-blue-400'); }
        if(pageId !== 'ppobPage') document.getElementById('ppobPage').classList.add('hide');
        if(pageId === 'loginPage' || pageId === 'registerPage') document.getElementById('bottomNav').classList.add('hide'); else document.getElementById('bottomNav').classList.remove('hide');
        updateUI();
    }

    // --- XL AKRAB LOGIC (NEW) ---
    function openXLAkrab() {
        // Reset form
        document.getElementById('xlProviderInput').value = '';
        document.getElementById('xlProductInput').innerHTML = '<option value="">-- Pilih Provider Terlebih Dahulu --</option>';
        document.getElementById('xlDestNumber').value = '';
        
        // Hide Home, Show XL Page
        document.getElementById('homePage').classList.add('hide');
        document.getElementById('bottomNav').classList.add('hide');
        document.getElementById('xlAkrabPage').classList.remove('hide');
    }

    function openProviderSelector() {
        const modal = document.getElementById('providerSelectorModal');
        const container = document.getElementById('providerListContainer');
        container.innerHTML = ''; // Clear list

        xlProvidersList.forEach(provName => {
            const isSelected = document.getElementById('xlProviderInput').value === provName;
            container.innerHTML += `
                <div class="provider-list-item ${isSelected ? 'selected' : ''}" onclick="selectXLProvider('${provName}')">
                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-200">${provName}</span>
                    <div class="custom-radio"></div>
                </div>
            `;
        });

        modal.classList.remove('hide');
    }

    function selectXLProvider(providerName) {
        document.getElementById('xlProviderInput').value = providerName;
        document.getElementById('providerSelectorModal').classList.add('hide');
        
        // Populate Products based on selection
        const productSelect = document.getElementById('xlProductInput');
        productSelect.innerHTML = '<option value="">-- Pilih Produk --</option>';
        
        const products = xlProducts[providerName] || [];
        products.forEach(prod => {
            productSelect.innerHTML += `<option value="${prod}">${prod}</option>`;
        });
    }

    function processXLPurchase() {
        const prov = document.getElementById('xlProviderInput').value;
        const prod = document.getElementById('xlProductInput').value;
        const num = document.getElementById('xlDestNumber').value;

        if(!prov || !prod || !num) return alert('Mohon lengkapi semua data!');
        
        // Dummy Price Extraction
        let price = 25000; // Default dummy
        if(prod.includes('Rp')) {
            const priceString = prod.match(/Rp\s?(\d+\.?\d*)/);
            if(priceString) price = parseInt(priceString[1].replace('.',''));
        }

        if(balance < price) return alert('Saldo tidak mencukupi!');

        customConfirm('Konfirmasi Transaksi', `Beli ${prod}\nNomor: ${num}\nHarga: ${formatRp(price)}?`, () => {
            balance -= price;
            transactions.unshift({
                title: 'XL Akrab: ' + prov,
                date: 'Baru saja',
                amount: price,
                type: 'out',
                icon: 'fa-users',
                colorBg: 'bg-blue-100 dark:bg-blue-900/30',
                colorText: 'text-blue-600 dark:text-blue-400'
            });
            updateUI();
            nav('homePage');
            document.getElementById('xlAkrabPage').classList.add('hide');
            alert('Transaksi XL Akrab Berhasil!');
        });
    }

    // --- LOGIN & REGISTER ---
    function handleLogin() { nav('homePage'); }
    function handleLogout() { customConfirm('Keluar Akun?', 'Anda yakin ingin keluar?', () => location.reload()); }
    function handleRegister() {
        if(!document.getElementById('regUsername').value) return alert('Isi Username!');
        alert('Pendaftaran Berhasil!'); nav('loginPage');
    }

    // --- SETTINGS LOGIC ---
    function loadSettings() {
        document.getElementById('setUsername').value = userProfile.username;
        document.getElementById('setEmail').value = userProfile.email;
        document.getElementById('setPhone').value = userProfile.phone;
        document.getElementById('setAge').value = userProfile.age;
        document.getElementById('setGender').value = userProfile.gender;
    }
    function saveSettings() {
        userProfile.username = document.getElementById('setUsername').value;
        document.getElementById('headerUsername').innerText = userProfile.username;
        document.getElementById('profileName').innerText = userProfile.username;
        alert('Profil diperbarui!'); nav('profilePage');
    }
    function changePassword() { customConfirm('Ganti Sandi', 'Kirim link reset sandi?', () => alert('Link terkirim!')); }

    // --- TOP UP & OTHERS ---
    function openTopUpSheet() { document.getElementById('topUpSheet').classList.remove('hide'); }
    function closeTopUp() { document.getElementById('topUpSheet').classList.add('hide'); }
    function processTopUp(m) { closeTopUp(); if(m==='manual'){ balance+=100000; transactions.unshift({type:'in',title:'Top Up Manual',date:'Baru saja',amount:100000,icon:'fa-plus',colorBg:'bg-green-100',colorText:'text-green-600'}); updateUI(); alert('Saldo +100rb'); } else if(m==='qris'){ startScan(); } }
    function showBankList() { closeTopUp(); document.getElementById('homePage').classList.add('hide'); document.getElementById('bottomNav').classList.add('hide'); document.getElementById('bankListPage').classList.remove('hide'); const l=document.getElementById('bankListContainer'); l.innerHTML=''; banks.forEach(b=>{ l.innerHTML+=`<div onclick="selectBank('${b.name}')" class="flex items-center gap-4 p-4 mb-2 bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800"><div class="w-10 h-10 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center font-bold text-gray-500 text-xs">${b.code}</div><span class="font-bold text-gray-700 dark:text-gray-300">${b.name}</span></div>` }); }
    function closeBankList() { document.getElementById('bankListPage').classList.add('hide'); nav('homePage'); document.getElementById('bottomNav').classList.remove('hide'); }
    function selectBank(n) { customConfirm('Transfer Bank', `Salin VA untuk ${n}?`, ()=>{ alert('VA Disalin'); closeBankList(); }); }
    function addDummyTrx(t,ti,a,i,c) { if(balance<a)return alert('Saldo kurang'); customConfirm('Konfirmasi',`Bayar ${ti} ${formatRp(a)}?`,()=>{ balance-=a; transactions.unshift({type:t,title:ti,date:'Baru saja',amount:a,icon:i,colorBg:'bg-yellow-100',colorText:'text-yellow-600'}); updateUI(); }); }

    // --- PPOB GENERAL ---
    function openPPOB(t) { currentPPOBType=t; selectedProvider=null; document.getElementById('homePage').classList.add('hide'); document.getElementById('bottomNav').classList.add('hide'); document.getElementById('ppobPage').classList.remove('hide'); document.getElementById('ppobTitle').innerText=t==='pulsa'?'Isi Pulsa':'Paket Data'; document.getElementById('inputSection').classList.add('hide'); document.getElementById('instructionText').classList.remove('hide'); document.getElementById('ppobNumber').value=''; renderProviders(); }
    function closePPOB() { document.getElementById('ppobPage').classList.add('hide'); nav('homePage'); }
    function renderProviders() { const c=document.getElementById('providerList'); c.innerHTML=''; providers.forEach(p=>{ c.innerHTML+=`<div onclick="selectProvider('${p.id}')" class="provider-btn ${p.id===selectedProvider?'active ring-2 ring-blue-500':'bg-white dark:bg-gray-800 border-gray-200'} min-w-[80px] p-2 rounded-xl border flex flex-col items-center justify-center cursor-pointer transition-all hover:scale-105"><i class="fas fa-sim-card text-2xl ${p.color} mb-1"></i><span class="text-[10px] font-bold text-gray-700 dark:text-gray-300">${p.name}</span></div>` }); }
    function selectProvider(id) { selectedProvider=id; renderProviders(); document.getElementById('inputSection').classList.remove('hide'); document.getElementById('instructionText').classList.add('hide'); renderProducts(); }
    function renderProducts() { const c=document.getElementById('productList'); c.innerHTML=''; pulsaOptions.forEach(a=>{ c.innerHTML+=`<div onclick="confirmTransaction('Pulsa ${selectedProvider} ${formatRp(a)}',${a+1500})" class="bg-white dark:bg-gray-900 p-4 rounded-xl border border-gray-100 dark:border-gray-800 shadow-sm flex justify-between items-center cursor-pointer hover:border-orange-500 transition"><div><p class="font-bold text-lg text-gray-800 dark:text-white">${formatRp(a)}</p><p class="text-[10px] text-gray-400">Harga: ${formatRp(a+1500)}</p></div><button class="bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-4 py-1 rounded-full text-xs font-bold">Beli</button></div>` }); }
    function confirmTransaction(n,p) { if(document.getElementById('ppobNumber').value.length<4) return alert('No HP Salah'); if(balance<p) return alert('Saldo kurang'); customConfirm('Beli',`Beli ${n}?`,()=>{ balance-=p; transactions.unshift({title:n,date:'Baru saja',amount:p,type:'out',icon:'fa-mobile-alt',colorBg:'bg-indigo-100',colorText:'text-indigo-600'}); updateUI(); closePPOB(); nav('homePage'); }); }
    function detectProvider() { const v=document.getElementById('ppobNumber').value; let d=null; if(v.startsWith('081'))d='telkomsel'; else if(v.startsWith('085'))d='indosat'; else if(v.startsWith('087'))d='xl'; if(d&&d!==selectedProvider) selectProvider(d); }

    // --- UI UPDATE ---
    function updateUI() {
        document.getElementById('displayBalance').innerText = formatRp(balance);
        let html = '';
        transactions.slice(0,4).forEach(t => { html += `<div class="flex justify-between items-center bg-white dark:bg-gray-900 p-3 rounded-2xl border border-gray-50 dark:border-gray-800 shadow-sm transition"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full flex items-center justify-center ${t.colorBg} ${t.colorText}"><i class="fas ${t.icon}"></i></div><div><p class="font-bold text-sm text-gray-800 dark:text-white">${t.title}</p><p class="text-[10px] text-gray-400">${t.date}</p></div></div><span class="text-sm font-bold ${t.type==='out'?'text-gray-800 dark:text-white':'text-green-600'}">${t.type==='out'?'-':'+'} ${formatRp(t.amount)}</span></div>` });
        document.getElementById('miniHistory').innerHTML = html;
        let fullHtml = '';
        transactions.forEach(t => { fullHtml += `<div class="flex justify-between items-center bg-white dark:bg-gray-900 p-3 rounded-2xl border border-gray-50 dark:border-gray-800 shadow-sm mb-2"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full flex items-center justify-center ${t.colorBg} ${t.colorText}"><i class="fas ${t.icon}"></i></div><div><p class="font-bold text-sm text-gray-800 dark:text-white">${t.title}</p><p class="text-[10px] text-gray-400">${t.date}</p></div></div><span class="text-sm font-bold ${t.type==='out'?'text-gray-800 dark:text-white':'text-green-600'}">${t.type==='out'?'-':'+'} ${formatRp(t.amount)}</span></div>` });
        document.getElementById('fullHistory').innerHTML = fullHtml;
    }

    // --- QRIS ---
    let scanner = null;
    function startScan() { document.querySelectorAll('.page').forEach(e=>e.classList.add('hide')); document.getElementById('scanPage').classList.remove('hide'); document.getElementById('bottomNav').classList.add('hide'); scanner = new Html5QrcodeScanner("reader", {fps:10, qrbox:{width:250,height:250}}, false); scanner.render((d)=>{stopScanInternal();openPaymentPage(d||"Merchant QRIS");}, ()=>{}); }
    function stopScan() { stopScanInternal(); nav('homePage'); document.getElementById('bottomNav').classList.remove('hide'); }
    function stopScanInternal() { if(scanner){scanner.clear();scanner=null;} }
    function simulateSuccessScan() { stopScanInternal(); openPaymentPage("Warung Makan Enak"); }
    function openPaymentPage(n) { document.getElementById('scanPage').classList.add('hide'); document.getElementById('paymentPage').classList.remove('hide'); document.getElementById('merchantName').innerText=n; document.getElementById('qrisAmount').value=''; }
    function cancelPayment() { document.getElementById('paymentPage').classList.add('hide'); nav('homePage'); document.getElementById('bottomNav').classList.remove('hide'); }
    function processQrisPayment() { const a=parseInt(document.getElementById('qrisAmount').value); if(!a||a>balance)return alert('Saldo kurang/Nominal salah'); customConfirm('Bayar',`Bayar QRIS ${formatRp(a)}?`,()=>{ balance-=a; transactions.unshift({title:document.getElementById('merchantName').innerText,date:'Baru saja',amount:a,type:'out',icon:'fa-qrcode',colorBg:'bg-blue-100',colorText:'text-blue-600'}); cancelPayment(); updateUI(); }); }

    updateUI();
</script>
</body>
</html>