[
  {
    "snippet": "        <div class=\"p-4 pb-24\">\n            <div id=\"inputSection\" class=\"transition-all duration-300\">\n                <div class=\"bg-white dark:bg-gray-900 p-5 rounded-3xl shadow-lg border border-gray-100 dark:border-gray-800\">\n                    \n                    \n                    <div class=\"mb-4\">\n                        <label class=\"block text-xs font-bold text-gray-500 mb-1 ml-1\">Provider</label>\n                        <div class=\"relative\">\n                            <select id=\"formProvider\" onchange=\"updateProductDropdown()\" class=\"w-full bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-800 dark:text-white text-sm rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none font-bold\">\n                                <option value=\"\" disabled selected>-- Pilih Provider --</option>\n                                <optgroup label=\"Khfy Produk\">\n                                    <option value=\"XDA\">Akrab Fresh (XDA)</option>\n                                    <option value=\"XLA\">Akrab Fresh (XLA)</option>\n                                    <option value=\"FMX\">FlexMax (FMX)</option>\n                                    <option value=\"PLN\">PLN Pascabayar</option>\n                                </optgroup>\n                                <optgroup label=\"Operator Reguler\">\n                                    <option value=\"TELKOMSEL\">Telkomsel</option>\n                                    <option value=\"INDOSAT\">Indosat</option>\n                                    <option value=\"XL\">XL Axiata</option>\n                                    <option value=\"AXIS\">Axis</option>\n                                    <option value=\"TRI\">Three (3)</option>\n                                    <option value=\"SMARTFREN\">Smartfren</option>\n                                </optgroup>\n                            </select>\n                            <i class=\"fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none\"></i>\n                        </div>\n                    </div>\n\n                    \n                    <div class=\"mb-4\">\n                        <label class=\"block text-xs font-bold text-gray-500 mb-1 ml-1\">Produk</label>\n                        <div class=\"relative\">\n                            <select id=\"formProduct\" disabled class=\"w-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 text-sm rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none font-medium transition-colors\">\n                                <option value=\"\">Menunggu Provider...</option>\n                            </select>\n                            <i class=\"fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none\"></i>\n                        </div>\n                        <p class=\"text-[10px] text-blue-500 mt-1 text-right font-bold\" id=\"priceDisplay\"></p>\n                    </div>\n\n                    \n                    <div class=\"mb-6\">\n                        <label class=\"block text-xs font-bold text-gray-500 mb-1 ml-1\">Nomor Tujuan</label>\n                        <div class=\"input-group\">\n                            <input type=\"tel\" id=\"ppobNumber\" placeholder=\"Nomor HP / ID Pelanggan\" class=\"w-full h-12 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white dark:focus:bg-gray-800 text-gray-800 dark:text-white text-sm font-bold\">\n                            <i class=\"fas fa-address-book text-gray-400\"></i>\n                        </div>\n                    </div>\n\n                    \n                    <button onclick=\"processFormTransaction()\" class=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-500/30 active:scale-95 transition-transform flex justify-center items-center gap-2\">\n                        <span>Beli Paket</span>\n                        <i class=\"fas fa-arrow-right\"></i>\n                    </button>\n\n                    \n                    <div class=\"flex items-center gap-2 mt-4\">\n                        <div class=\"w-4 h-4 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800\"></div>\n                        <span class=\"text-xs text-gray-500\">Aktifkan Multi Transaksi</span>\n                    </div>\n                </div>\n            </div>\n        </div>",
    "target": "<div class=\"p-4 pb-24\">[\\s\\S]*?id=\"productList\"[\\s\\S]*?</div>\\s*</div>\\s*</div>",
    "action": "replace",
    "regex": true,
    "global": false
  },
  {
    "snippet": "    // --- LOGIKA UTAMA (FORMULIR BARU) ---\n    let globalProducts = []; // Simpan data produk disini\n\n    // 1. Init Data (Dipanggil saat buka menu)\n    async function initProductData() {\n        const pSelect = document.getElementById('formProduct');\n        pSelect.innerHTML = '<option>Sedang memuat data...</option>';\n        \n        const result = await callApi('/list_product');\n        if (result.ok && result.data) {\n            // Normalisasi Data\n            if (result.data.data && Array.isArray(result.data.data)) globalProducts = result.data.data;\n            else if (Array.isArray(result.data)) globalProducts = result.data;\n            else if (result.data.products) globalProducts = result.data.products;\n            \n            pSelect.innerHTML = '<option value=\"\">-- Pilih Provider Dahulu --</option>';\n        } else {\n            pSelect.innerHTML = '<option>Gagal Load Data</option>';\n            alert('Gagal mengambil data produk: ' + result.error);\n        }\n    }\n\n    // 2. Filter Produk berdasarkan Provider\n    function updateProductDropdown() {\n        const providerCode = document.getElementById('formProvider').value;\n        const productSelect = document.getElementById('formProduct');\n        const priceDisplay = document.getElementById('priceDisplay');\n        \n        // Reset UI Dropdown\n        productSelect.innerHTML = '';\n        productSelect.disabled = false;\n        productSelect.className = 'w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-800 dark:text-white text-sm rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none font-medium transition-colors';\n        priceDisplay.innerText = '';\n\n        // Logika Filter\n        const filtered = globalProducts.filter(p => {\n            const code = (p.code || p.buyer_sku_code || '').toUpperCase();\n            const name = (p.name || p.product_name || '').toUpperCase();\n            const brand = (p.brand || p.operator || '').toUpperCase();\n            \n            // Kategori Khusus (XDA/XLA/FMX/PLN)\n            if(['XDA', 'XLA', 'FMX', 'PLN'].includes(providerCode)) {\n                return code.startsWith(providerCode) || name.includes(providerCode);\n            }\n            // Operator Biasa (TELKOMSEL, dll)\n            return brand.includes(providerCode) || name.includes(providerCode);\n        });\n\n        if(filtered.length === 0) {\n            productSelect.innerHTML = `<option>Produk Kosong / Tidak Ditemukan</option>`;\n            productSelect.disabled = true;\n            return;\n        }\n\n        // Urutkan Harga\n        filtered.sort((a, b) => (a.price || a.buyer_price) - (b.price || b.buyer_price));\n\n        // Render Option\n        productSelect.innerHTML = '<option value=\"\" selected disabled>-- Pilih Produk --</option>';\n        filtered.forEach(p => {\n            const price = p.price || p.harga || p.buyer_price || 0;\n            const code = p.code || p.buyer_sku_code;\n            const name = p.name || p.product_name;\n            const status = p.status || p.buyer_product_status || true;\n            const isGangguan = (status.toString() === '0' || status === false || status === 'gangguan');\n            \n            const opt = document.createElement('option');\n            opt.value = code;\n            opt.text = name + (isGangguan ? ' (GANGGUAN)' : '');\n            opt.dataset.price = price;\n            opt.dataset.name = name;\n            if(isGangguan) opt.disabled = true;\n            productSelect.appendChild(opt);\n        });\n\n        // Event Ganti Produk\n        productSelect.onchange = function() {\n             const selectedOpt = this.options[this.selectedIndex];\n             priceDisplay.innerText = `Harga: Rp ${formatRp(selectedOpt.dataset.price)}`;\n        };\n    }\n\n    // 3. Proses Transaksi\n    function processFormTransaction() {\n        const productSelect = document.getElementById('formProduct');\n        const destNum = document.getElementById('ppobNumber').value;\n\n        if(!productSelect.value) return alert('Silakan pilih Produk!');\n        if(destNum.length < 5) return alert('Masukkan Nomor Tujuan yang valid!');\n\n        const selectedOpt = productSelect.options[productSelect.selectedIndex];\n        confirmTransaction(productSelect.value, selectedOpt.dataset.name, parseInt(selectedOpt.dataset.price));\n    }\n\n    // --- TRANSAKSI ---",
    "target": "// --- LOGIKA UTAMA ---[\\s\\S]*?// --- TRANSAKSI ---",
    "action": "replace",
    "regex": true,
    "global": false
  },
  {
    "snippet": "    function openPPOB(category) { \n        activeCategory = category;\n        document.getElementById('homePage').classList.add('hide'); \n        document.getElementById('ppobPage').classList.remove('hide'); \n        document.getElementById('bottomNav').classList.add('hide'); \n        \n        // Reset Form UI\n        document.getElementById('ppobNumber').value = ''; \n        if(document.getElementById('priceDisplay')) document.getElementById('priceDisplay').innerText = '';\n        document.getElementById('formProvider').selectedIndex = 0;\n        document.getElementById('formProduct').innerHTML = '<option value=\"\">Menunggu Provider...</option>';\n        document.getElementById('formProduct').disabled = true;\n        document.getElementById('formProduct').className = 'w-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 text-sm rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none font-medium transition-colors';\n        \n        document.getElementById('ppobTitle').innerText = category === 'akrab' ? 'XL Akrab & Paket' : 'Isi Pulsa / Data';\n        \n        // Load Data API\n        initProductData();\n    }\n    \n    function closePPOB",
    "target": "function openPPOB\\(category\\) \\{[\\s\\S]*?function closePPOB",
    "action": "replace",
    "regex": true,
    "global": false
  }
]